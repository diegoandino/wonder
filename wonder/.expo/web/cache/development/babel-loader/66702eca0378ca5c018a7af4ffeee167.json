{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport MapView from 'react-native-maps';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport * as Location from 'expo-location';\nimport * as Permissions from 'expo-permissions';\nimport { Marker } from 'react-native-maps';\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport UserModal from \"./UserModal\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar getUser = function getUser() {\n  return fetch('http://10.100.1.141:3000/get_me').then(function (res) {\n    return res.json();\n  });\n};\n\nvar getUsersInArea = function getUsersInArea() {\n  return fetch('http://10.100.1.141:8080/get_logged_in_users').then(function (res) {\n    return res.json();\n  });\n};\n\nexport default function Map() {\n  var _useState = useState(0),\n      _useState2 = _slicedToArray(_useState, 2),\n      latitude = _useState2[0],\n      setLatitude = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      longitude = _useState4[0],\n      setLongitude = _useState4[1];\n\n  var _useState5 = useState(0.0922),\n      _useState6 = _slicedToArray(_useState5, 2),\n      latitudeDelta = _useState6[0],\n      setLatitudeDelta = _useState6[1];\n\n  var _useState7 = useState(0.0421),\n      _useState8 = _slicedToArray(_useState7, 2),\n      longitudeDelta = _useState8[0],\n      setLongitudeDelta = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      hasLocationPermissions = _useState10[0],\n      setHasLocationPermissions = _useState10[1];\n\n  var _useState11 = useState(null),\n      _useState12 = _slicedToArray(_useState11, 2),\n      locationResult = _useState12[0],\n      setLocationResult = _useState12[1];\n\n  var _useState13 = useState(null),\n      _useState14 = _slicedToArray(_useState13, 2),\n      user = _useState14[0],\n      setUser = _useState14[1];\n\n  var _useState15 = useState(null),\n      _useState16 = _slicedToArray(_useState15, 2),\n      usersInArea = _useState16[0],\n      setUsersInArea = _useState16[1];\n\n  var _useState17 = useState(false),\n      _useState18 = _slicedToArray(_useState17, 2),\n      showModal = _useState18[0],\n      setShowModal = _useState18[1];\n\n  useEffect(function () {\n    getUser().then(function (data) {\n      return setUser(data);\n    });\n    getUsersInArea().then(function (data) {\n      return setUsersInArea(data);\n    });\n  }, []);\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var _yield$Permissions$as = yield Permissions.askAsync(Permissions.LOCATION_FOREGROUND),\n          status = _yield$Permissions$as.status;\n\n      if (status !== 'granted') {\n        setLocationResult({\n          locationResult: 'Permission to access location was denied'\n        });\n      } else {\n        setHasLocationPermissions(true);\n      }\n\n      var location = yield Location.getCurrentPositionAsync({});\n      setLocationResult(location);\n      setLatitude(location.coords.latitude);\n      setLongitude(location.coords.longitude);\n    })();\n  }, []);\n  useEffect(function () {\n    if (user != null) {\n      var username = user.uri.replace('spotify:user:', '');\n      fetch('http://10.100.1.141:8080/update_user', {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username: username,\n          location: {\n            latitude: latitude,\n            longitude: longitude\n          },\n          logged_in: true\n        })\n      }).catch(function (err) {\n        return console.log('Fetch Error: ', err);\n      });\n    }\n  });\n  return _jsx(View, {\n    style: styles.container,\n    children: hasLocationPermissions && locationResult != null && _jsxs(MapView, {\n      provider: MapView.PROVIDER_GOOGLE,\n      style: styles.map,\n      region: {\n        latitude: latitude,\n        longitude: longitude,\n        latitudeDelta: latitudeDelta,\n        longitudeDelta: longitudeDelta\n      },\n      onPress: function onPress() {\n        return showModal ? setShowModal(false) : null;\n      },\n      children: [user != null && _jsx(Marker, {\n        coordinate: {\n          latitude: latitude,\n          longitude: longitude,\n          latitudeDelta: latitudeDelta,\n          longitudeDelta: longitudeDelta\n        },\n        onPress: function onPress() {\n          return setShowModal(true);\n        },\n        children: _jsx(Image, {\n          source: {\n            uri: user.images[0].url\n          },\n          style: {\n            width: 64,\n            height: 64,\n            borderRadius: 30\n          }\n        })\n      }), hasLocationPermissions && locationResult != null && usersInArea != null && usersInArea.map(function (user) {\n        return _jsx(Marker, {\n          coordinate: {\n            latitude: user.location.lat,\n            longitude: user.location.lng,\n            latitudeDelta: latitudeDelta,\n            longitudeDelta: longitudeDelta\n          },\n          onPress: function onPress() {\n            return setShowModal(true);\n          }\n        });\n      }), showModal && _jsx(UserModal, {\n        showModal: true\n      })]\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  map: {\n    width: Dimensions.get('window').width,\n    height: Dimensions.get('window').height\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","MapView","Location","Permissions","Marker","AsyncStorage","UserModal","getUser","fetch","then","res","json","getUsersInArea","Map","latitude","setLatitude","longitude","setLongitude","latitudeDelta","setLatitudeDelta","longitudeDelta","setLongitudeDelta","hasLocationPermissions","setHasLocationPermissions","locationResult","setLocationResult","user","setUser","usersInArea","setUsersInArea","showModal","setShowModal","data","askAsync","LOCATION_FOREGROUND","status","location","getCurrentPositionAsync","coords","username","uri","replace","method","headers","Accept","body","JSON","stringify","logged_in","catch","err","console","log","styles","container","PROVIDER_GOOGLE","map","images","url","width","height","borderRadius","lat","lng","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent","Dimensions","get"],"sources":["C:/Users/andin/OneDrive/Documents/Dev/personal/Wonder/wonder/components/Map.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport MapView from 'react-native-maps';\r\nimport { StyleSheet, View, Dimensions, Image } from 'react-native';\r\nimport * as Location from 'expo-location';\r\nimport * as Permissions from 'expo-permissions';\r\nimport { Marker } from 'react-native-maps';\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport UserModal from './UserModal';\r\n\r\nconst getUser = () => fetch('http://10.100.1.141:3000/get_me').then(res => res.json());\r\nconst getUsersInArea = () => fetch('http://10.100.1.141:8080/get_logged_in_users').then(res => res.json());\r\n\r\nexport default function Map() {\r\n  const[latitude, setLatitude] = useState(0);\r\n  const[longitude, setLongitude] = useState(0);\r\n  const[latitudeDelta, setLatitudeDelta] = useState(0.0922);\r\n  const[longitudeDelta, setLongitudeDelta] = useState(0.0421);\r\n  const[hasLocationPermissions, setHasLocationPermissions] = useState(false);\r\n  const[locationResult, setLocationResult] = useState(null);\r\n  const[user, setUser] = useState(null);\r\n  const[usersInArea, setUsersInArea] = useState(null);\r\n  const[showModal, setShowModal] = useState(false);\r\n\r\n  useEffect(() => {\r\n    getUser().then(data => setUser(data));\r\n    getUsersInArea().then(data => setUsersInArea(data));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      let { status } = await Permissions.askAsync(Permissions.LOCATION_FOREGROUND);\r\n      if (status !== 'granted') {\r\n        setLocationResult({\r\n          locationResult: 'Permission to access location was denied',\r\n        });\r\n      }\r\n      else { setHasLocationPermissions(true); }\r\n    \r\n      let location = await Location.getCurrentPositionAsync({});\r\n      setLocationResult(location);\r\n      setLatitude(location.coords.latitude);\r\n      setLongitude(location.coords.longitude);\r\n    })()\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user != null) {\r\n      const username = user.uri.replace('spotify:user:', '');\r\n      fetch('http://10.100.1.141:8080/update_user', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        Accept: 'application/json',\r\n                        'Content-Type': 'application/json',\r\n                        },\r\n                    body: JSON.stringify({\r\n                            username: username,\r\n                            location: {\r\n                                latitude: latitude,\r\n                                longitude: longitude,\r\n                            },\r\n                            logged_in: true,\r\n                    })\r\n      }).catch(err => console.log('Fetch Error: ', err));\r\n    }\r\n  });\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      {hasLocationPermissions && locationResult != null && (\r\n        <MapView\r\n          provider={MapView.PROVIDER_GOOGLE}\r\n          style={styles.map}\r\n          region={{ latitude: latitude, longitude: longitude, latitudeDelta: latitudeDelta, longitudeDelta: longitudeDelta }}\r\n          onPress={() => showModal ? setShowModal(false) : null}>\r\n          {user != null &&\r\n            <Marker\r\n              coordinate={{ latitude: latitude, longitude: longitude, latitudeDelta: latitudeDelta, longitudeDelta: longitudeDelta }}\r\n              onPress={() => setShowModal(true)}\r\n            >\r\n              <Image\r\n                source={{uri: user.images[0].url}} \r\n                style={{width: 64, height: 64, borderRadius: 30}}>\r\n              </Image>\r\n            </Marker>\r\n          }\r\n          {hasLocationPermissions && locationResult != null && usersInArea != null && (usersInArea.map(user => \r\n            <Marker coordinate={{ latitude: user.location.lat, \r\n                                  longitude: user.location.lng, \r\n                                  latitudeDelta: latitudeDelta, \r\n                                  longitudeDelta: longitudeDelta }}\r\n                    onPress={() => setShowModal(true)}\r\n            >\r\n            </Marker>\r\n          ))}\r\n          {showModal && <UserModal showModal={true}/>}\r\n        </MapView>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  map: {\r\n    width: Dimensions.get('window').width,\r\n    height: Dimensions.get('window').height,\r\n  },\r\n});"],"mappings":"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"},"metadata":{},"sourceType":"module"}